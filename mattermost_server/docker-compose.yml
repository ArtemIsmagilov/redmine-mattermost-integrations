version: "3.9"
services:
  mattermost:
    image: "mattermost/mattermost-enterprise-edition" # https://hub.docker.com/r/mattermost/mattermost-enterprise-edition/tags
    restart: "unless-stopped"
    depends_on:
      - "db"
    ports:
      - "8065:8065"
    environment:
      MM_SQLSETTINGS_DRIVERNAME: "postgres"
      MM_SQLSETTINGS_DATASOURCE: "postgres://user:password@db/mattermost_db?sslmode=disable\u0026connect_timeout=10"
      MM_SERVICESETTINGS_LISTENADDRESS: ":8065"
      MM_SERVICESETTINGS_SITEURL: "http://mattermost:8065"
      MM_SERVICESETTINGS_ENABLEBOTACCOUNTCREATION: "true"
      MM_SERVICESETTINGS_ENABLEUSERACCESSTOKENS: "true"
      MM_SERVICESETTINGS_ENABLEOAUTHSERVICEPROVIDER: "true"
      MM_SERVICESETTINGS_ENABLEDEVELOPER: "true"
      MM_SERVICESETTINGS_ENABLETESTING: "true"
      MM_PLUGINSETTINGS_AUTOMATICPREPACKAGEDPLUGINS: "true"
      MM_EXPERIMENTALSETTINGS_ENABLEAPPBAR: "true"
      MM_PLUGINSETTINGS_ENABLEUPLOADS: "true"
      MM_LOGSETTINGS_CONSOLELEVEL: "DEBUG"
      MM_LOGSETTINGS_FILELEVEL: "DEBUG"
      MM_FILESETTINGS_MAXFILESIZE: 123524266
      MM_FEATUREFLAGS_AppsEnabled: "true"
      MM_FEATUREFLAGS_PluginApps: "1.2.1" # https://github.com/mattermost/mattermost-plugin-apps/releases
    volumes:
      - "./mm-logs:/mattermost/logs:rw"

    networks:
      dev:
        ipv4_address: 172.10.1.30

  db:
    image: "postgres"
    restart: "always"
    ports:
      - "50001:50001"
    environment:
      POSTGRES_PASSWORD: "password"
      POSTGRES_USER: "user"
      POSTGRES_DB: "mattermost_db"

    networks:
      dev:
        ipv4_address: 172.10.1.40

networks:
  dev:
    external: true

